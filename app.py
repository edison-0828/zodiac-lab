import streamlit as st
import hashlib
import time

# 1. é¡µé¢åŸºç¡€é…ç½®
st.set_page_config(page_title="çµé­‚å¥‘åˆåº¦å®éªŒå®¤", page_icon="ğŸŒ™", layout="centered")

# 2. CSS æ³¨å…¥ï¼šå›ºå®šç™½è‰²èƒŒæ™¯ï¼Œä¼˜åŒ–æ·±è‰²æ–‡å­—
st.markdown("""
    <style>
    /* å¼ºåˆ¶å›ºå®šç½‘é¡µèƒŒæ™¯ä¸ºç™½è‰² */
    .stApp {
        background-color: #FFFFFF !important;
        color: #31333F !important;
    }
    
    /* ç¡®ä¿è¾“å…¥æ¡†å’Œå¤šé€‰æ¡†çš„æ ‡ç­¾ä¸ºæ·±è‰²ä¸”åŠ ç²— */
    .stSelectbox label, .stMultiSelect label {
        font-size: 1.2rem !important;
        font-weight: 800 !important;
        color: #1E1E1E !important;
        padding-top: 15px;
    }

    /* é’ˆå¯¹ç™½åº•ä¼˜åŒ–åˆ†å‰²çº¿é¢œè‰² */
    hr {
        border-top: 1px solid #E6E6E6 !important;
    }
    </style>
    """, unsafe_allow_html=True)

def main():
    st.title("ğŸŒ™ çµé­‚å¥‘åˆåº¦å®éªŒå®¤")
    st.write("å·²åˆ‡æ¢è‡³**ç®€çº¦ç™½è§†è§‰ä¸»é¢˜**ã€‚åŸºäºç”Ÿæ´»é€»è¾‘çš„ç¡®å®šæ€§åŒ¹é…ç³»ç»Ÿã€‚")
    st.divider()

    # --- 1. åŸºç¡€ä¿¡æ¯å½•å…¥ ---
    col1, col2 = st.columns(2)
    with col1:
        gender = st.selectbox("1. æ€ä¹ˆç§°å‘¼æ‚¨çš„æ€§åˆ«ï¼Ÿ", ["è¯·é€‰æ‹©...", "ç”·ç”Ÿ", "å¥³ç”Ÿ", "é…·å„¿/ä¿å¯†"])
    with col2:
        my_sign = st.selectbox("2. æ‚¨çš„æ˜Ÿåº§æ˜¯ï¼Ÿ", 
                             ["è¯·é€‰æ‹©...", "ç™½ç¾Šåº§", "é‡‘ç‰›åº§", "åŒå­åº§", "å·¨èŸ¹åº§", "ç‹®å­åº§", "å¤„å¥³åº§", 
                              "å¤©ç§¤åº§", "å¤©èåº§", "å°„æ‰‹åº§", "æ‘©ç¾¯åº§", "æ°´ç“¶åº§", "åŒé±¼åº§"])

    # --- 2. ç”Ÿæ´»åŒ–é—®é¢˜æ¸…å• ---
    questions = [
        ("3. å‘¨äº”æ™šä¸Šå›åˆ°å®¶ï¼Œä½ é€šå¸¸ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Ÿ", ["æ¢ä¸Šç¡è¡£å…³æ‰æ‰‹æœºèº²èµ·æ¥", "ç»™æ­»å…šæ‰“ä¸ªç”µè¯åæ§½", "å¼€å§‹æ¸…ç†å±‹å­", "æ‰“å¼€æŠ•å½±çœ‹ç”µå½±"]),
        ("4. å¦‚æœè¦é€ä½ ä¸€ä»½ç¤¼ç‰©ï¼Œä½ æœ€å¸Œæœ›æ”¶åˆ°ï¼Ÿ", ["è´¨æ„Ÿæå¥½çš„å®ç”¨å“", "å¾ˆæœ‰æ„ä¹‰çš„æ‰‹å·¥å°ç‰©ä»¶", "ä¸€å¼ å»è¿œæ–¹çš„æœºç¥¨", "æœ€æ–°é»‘ç§‘æŠ€æ•°ç "]),
        ("5. å¯¹æ–¹åšäº†è®©ä½ ä¸çˆ½çš„äº‹ï¼Œä½ ç¬¬ä¸€ååº”æ˜¯ï¼Ÿ", ["å½“åœºè¯´æ¸…æ¥š", "é»˜é»˜æ‰£åˆ†ï¼Œç›´åˆ°å½’é›¶", "å…ˆåæ€æ˜¯ä¸æ˜¯è‡ªå·±å¤ªæ•æ„Ÿäº†", "å†·é™åˆ—å‡ºé€»è¾‘è°ˆè°ˆ"]),
        ("6. ä½ ä»¬ä¸€èµ·é€›è¶…å¸‚ï¼Œä½ æœ€äº«å—å“ªä¸ªç¯èŠ‚ï¼Ÿ", ["ä¹°å®Œå³èµ°", "ä¹±é€›çœ‹æ–°å¥‡é›¶é£Ÿ", "å¯¹æ¯”æˆåˆ†å’Œæ€§ä»·æ¯”", "è¾¹èµ°è¾¹é—²èŠ"]),
        ("7. å½“ä½ å·¥ä½œé‡åˆ°å§”å±ˆæ—¶ï¼Œä½ æœ€æƒ³å¬åˆ°ï¼Ÿ", ["â€œæˆ‘å…»ä½ â€", "â€œå¸¦ä½ å»åƒé¡¿å¥½çš„â€", "â€œé€»è¾‘ä¸Šå¯¹æ–¹ç¡®å®ä¸å¯¹â€", "ä»€ä¹ˆéƒ½åˆ«è¯´ï¼ŒæŠ±æŠ±æˆ‘"]),
        ("8. æœ‹å‹åœˆé‡Œï¼Œä½ æœ€åæ„Ÿå“ªç§è¡Œä¸ºï¼Ÿ", ["åˆ·å±è´Ÿèƒ½é‡", "ç‚«è€€ç²¾è‡´ç”Ÿæ´»", "æ¯«æ— é€»è¾‘çš„æ ç²¾", "ä¸å›æ¶ˆæ¯å´å‘æœ‹å‹åœˆ"]),
        ("9. å‡å¦‚å¯ä»¥æ‹¥æœ‰ä¸€ç§è¶…èƒ½åŠ›ï¼Œä½ ä¼šé€‰ï¼Ÿ", ["ç¬é—´ç§»åŠ¨", "è¯»å¿ƒæœ¯", "æ—¶é—´é™æ­¢", "ç‚¹çŸ³æˆé‡‘"]),
        ("10. ç†æƒ³ä¸­çš„è€å»ç”Ÿæ´»æ˜¯æ€æ ·çš„ï¼Ÿ", ["å¼€ä¸ªèŠ±åº—æˆ–ä¹¦åº—", "å…¨çƒæ—…å±…", "é—¹å¸‚åŒºçš„é¡¶å±‚å…¬å¯“", "çƒ­çƒ­é—¹é—¹çš„å¤§å®¶åº­"])
    ]
    
    user_answers = []
    for i, (q_text, opts) in enumerate(questions, 3):
        ans = st.multiselect(q_text, opts, key=f"q{i}")
        user_answers.append("".join(sorted(ans)))

    st.write("---")

    # --- 3. ç»“æœè®¡ç®—ä¸å±•ç¤º ---
    if st.button("ğŸš€ å¼€å¯çµé­‚ç²¾å‡†æ¼”ç®—"):
        if gender == "è¯·é€‰æ‹©..." or my_sign == "è¯·é€‰æ‹©..." or any(not a for a in user_answers):
            st.error("âŒ æ•°æ®æ®‹ç¼ºï¼šè¯·å®Œæˆæ‰€æœ‰åŠ ç²—æ ‡é¢˜çš„é—®é¢˜ã€‚")
        else:
            # ç¡®å®šæ€§å“ˆå¸Œè¿ç®—
            raw_string = f"{gender}|{my_sign}|{'|'.join(user_answers)}"
            hash_hex = hashlib.md5(raw_string.encode()).hexdigest()
            hash_int = int(hash_hex, 16)
            
            with st.status("ğŸ”® æ¼”ç®—ä¸­å¿ƒæ­£åœ¨ç”ŸæˆæŠ¥å‘Š...", expanded=True) as status:
                st.write("æå–è¡Œä¸ºæŒ‡çº¹...")
                time.sleep(0.6)
                st.write("åŒ¹é…æ˜Ÿè½¨äº¤ç‚¹...")
                time.sleep(0.6)
                status.update(label="æ¼”ç®—å®Œæˆï¼", state="complete", expanded=False)

            # ç»“æœæ•°æ®åº“
            match_pool = [
                {"sign": "å¤©èåº§", "tag": "æ·±åº¦é“¾æ¥è€…", "reason": "ä½ éœ€è¦æåº¦çš„å¦è¯šå’Œæ·±åº¦çš„æƒ…æ„Ÿè¿æ¥ï¼Œè€Œå¤©èçš„ä¸“æ³¨èƒ½å¡«æ»¡ä½ çš„å®‰å…¨æ„Ÿã€‚"},
                {"sign": "æ‘©ç¾¯åº§", "tag": "ç¨³å¥åˆä¼™äºº", "reason": "ä½ çš„åŠ¡å®ä¸æ‘©ç¾¯çš„é è°±æ˜¯å¤©ä½œä¹‹åˆï¼Œä½ ä»¬æ˜¯å½¼æ­¤æœ€ç¨³å®šçš„ç”Ÿæ´»åˆä¼™äººã€‚"},
                {"sign": "åŒå­åº§", "tag": "çµæ„Ÿå…±é¸£è€…", "reason": "ä½ å†…å¿ƒè—ç€çš„å¥½å¥‡å¿ƒï¼Œåªæœ‰åŒå­èƒ½æ¥ä½é‚£äº›å¥‡å¥‡æ€ªæ€ªçš„æ¢—ï¼Œè®©ç”Ÿæ´»æ°¸è¿œä¸è…»ã€‚"},
                {"sign": "å·¨èŸ¹åº§", "tag": "æ¸©æŸ”å®ˆæŠ¤è€…", "reason": "ä½ å¤–å†·å†…çƒ­ï¼Œå·¨èŸ¹é‚£ç§æ¶¦ç‰©ç»†æ— å£°çš„ä½“è´´ï¼Œæœ€èƒ½èåŒ–ä½ çš„æ­¦è£…ã€‚"},
                {"sign": "ç‹®å­åº§", "tag": "åšå®šåçˆ±è€…", "reason": "ä½ æœ‰æ—¶ä¼šé™·å…¥çŠ¹è±«ï¼Œè€Œç‹®å­çš„æœæ•¢å’Œå…‰èŠ’èƒ½å¸¦ä½ æ‰“ç ´åƒµå±€ï¼Œå¹¶ç»™ä½ åšå®šçš„åçˆ±ã€‚"},
                {"sign": "æ°´ç“¶åº§", "tag": "è‡ªç”±çµé­‚å®¶", "reason": "ä½ è®¨åŒè¢«æŸç¼šï¼Œæ°´ç“¶æ—¢èƒ½ç»™ä½ ç»å¯¹çš„è‡ªç”±ï¼Œåˆèƒ½å’Œä½ è¿›è¡Œçµé­‚æ·±å¤„çš„å¯¹è¯ã€‚"}
            ]
            
            res = match_pool[hash_int % len(match_pool)]
            comp_score = 85 + (hash_int % 15)
            
            st.balloons()

            # --- åŸç”Ÿå±•ç¤ºï¼šç™½åº•é»‘å­—é£æ ¼ ---
            st.divider()
            st.write("### åŒ¹é…ç»“æœï¼š")
            st.title(f"âœ¨ {res['sign']} Â· {res['tag']}")
            
            # ä½¿ç”¨åŸç”Ÿ info ç»„ä»¶ï¼ˆåœ¨ç™½åº•ä¸Šè‡ªå¸¦æµ…è“èƒŒæ™¯ï¼Œéå¸¸é†’ç›®ï¼‰
            st.info(f"**ğŸ’¡ ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªç»“æœï¼Ÿ**\n\n{res['reason']}")
            
            # æŠ¥å‘Šç»†èŠ‚å¡ç‰‡
            with st.container(border=True):
                st.markdown("**ğŸ” æ¼”ç®—é€è§†æŠ¥å‘Š**")
                col_a, col_b = st.columns(2)
                col_a.metric("å¥‘åˆåº¦æŒ‡æ•°", f"{comp_score}%")
                col_b.metric("ç£åœºæŒ‡çº¹", hash_hex[:8].upper())
                
                st.write(f"- åŸºäºæ‚¨å¯¹ **â€œ{questions[0][0][3:7]}â€** ç­‰ç”Ÿæ´»ç»†èŠ‚çš„é€‰æ‹©ã€‚")
                st.write("- æ‚¨åœ¨å…³ç³»ä¸­æ›´å€¾å‘äºå¯»æ‰¾ **ç¨³å®šæ€§ä¸å…±é¸£æ„Ÿçš„å¹³è¡¡**ã€‚")
            
            st.caption(f"æ ¡éªŒå“ˆå¸Œ: {hash_hex}")

if __name__ == "__main__":
    main()